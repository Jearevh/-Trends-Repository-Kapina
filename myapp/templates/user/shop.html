{% extends 'user/base.html' %}
{% load static %}

{% block title %}{{ shop.business_name }}{% endblock %}

{% block content %}
    <div class="container">
        <div class="shop-header">
            <div class="shop-name">{{ shop.business_name }}</div>
            <div class="shop-address">{{ shop.address }}</div>
            <div class="shop-hours">{{ shop.hours|default:"Hours not specified" }}</div>
            <div class="shop-tags">{{ shop.description|truncatewords:10 }}</div>
            <div class="shop-status">{{ shop_status }}</div>
            <div class="favorite">
                <span style="color: #222222; font-size: 20px; font-weight: 200;">♡ </span>
                <span class="favorite-text">Favorite</span>
            </div>
            {% if shop.logo %}
                <img class="shop-main-img" src="{{ shop.logo.url }}" alt="{{ shop.business_name }}" />
            {% else %}
                <img class="shop-main-img" src="https://placehold.co/648x365" alt="{{ shop.business_name }}" />
            {% endif %}
            <img class="shop-sub-img sub-img-1" src="https://placehold.co/307x175" alt="{{ shop.business_name }} 1" />
            <img class="shop-sub-img sub-img-2" src="https://placehold.co/307x175" alt="{{ shop.business_name }} 2" />
            <img class="shop-sub-img sub-img-3" src="https://placehold.co/307x175" alt="{{ shop.business_name }} 3" />
            <img class="shop-sub-img sub-img-4" src="https://placehold.co/307x175" alt="{{ shop.business_name }} 4" />
        </div>

        <div class="menu-title">Menu</div>

        <div class="cart">
            <div class="cart-inner"></div>
            <div class="cart-title">Your items</div>
            <div class="cart-items">
                <!-- Cart items will be dynamically added here via JavaScript -->
            </div>
            <div class="cart-divider"></div>
            <div class="checkout-btn">
                <div class="checkout-btn-text">Finalize Pre-Order</div>
            </div>
        </div>

        <div class="menu-items-container">
            {% for product in products %}
            <div class="menu-item">
                {% if product.image %}
                    <img class="menu-item-img" src="{{ product.image.url }}" alt="{{ product.name }}" />
                {% else %}
                    <img class="menu-item-img" src="https://placehold.co/156x173" alt="{{ product.name }}" />
                {% endif %}
                <div class="menu-item-name">{{ product.name }}</div>
                <div class="menu-item-price">₱ {{ product.price }}</div>
                <div class="menu-item-desc">{{ product.description|default:"No description available" }}</div>
                <div class="order-btn" data-product-id="{{ product.id }}" data-product-name="{{ product.name }}" data-product-price="{{ product.price }}">
                    <div class="order-btn-text">Pre-order</div>
                </div>
            </div>
            {% empty %}
            <div class="no-products">
                <p>This shop hasn't added any menu items yet.</p>
                {% if user.is_authenticated and user.businessprofile == shop %}
                <a href="{% url 'inventory' %}" class="add-menu-btn">Add Menu Items</a>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cart = {
                items: [],
                total: 0
            };

            // Add to cart functionality
            document.querySelectorAll('.order-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.dataset.productId;
                    const productName = this.dataset.productName;
                    const productPrice = parseFloat(this.dataset.productPrice);

                    // Add item to cart
                    cart.items.push({
                        id: productId,
                        name: productName,
                        price: productPrice
                    });
                    cart.total += productPrice;

                    // Update cart display
                    updateCartDisplay();
                });
            });

            function updateCartDisplay() {
                const cartItems = document.querySelector('.cart-items');
                cartItems.innerHTML = '';

                cart.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'cart-item';
                    itemElement.innerHTML = `
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">₱ ${item.price}</div>
                    `;
                    cartItems.appendChild(itemElement);
                });
            }

            // Checkout button functionality
            document.querySelector('.checkout-btn').addEventListener('click', function() {
                if (cart.items.length === 0) {
                    alert('Your cart is empty!');
                    return;
                }
                // Add your checkout logic here
                alert('Proceeding to checkout...');
            });
        });
    </script>
{% endblock %} 